@*  todo:دکمه لودینگ دار برای اپدیت فیلم وتصویر
    //todo:loding button ایچجاد کنم
*@

@model IEnumerable<CountryListDto>
@{
    ViewData["Title"] = "مدیریت کشورها";
}
<link href="~/node_modules/sweetalert2/dist/sweetalert2.css" rel="stylesheet" />
<style>
    tr th {
        text-align: center !important;
    }
</style>

<div class="card-body">
    <div>
        <a class="btn btn-primary" data-toggle="modal" asp-area="AdminPanel" asp-controller="Country" asp-action="CreateCountry"
           data-target="#modal-action-country" id="add-country">
            <i class="fa fa-plus"></i>
            <span>افزودن  کشور</span>
        </a>
    </div>

    <table class="table table-striped table-sm  table-hover mt-3 text-center ">
        <thead>
            <tr>

                <th>ردیف</th>
                <!-- Html Helper for dynamic implementing the property titles of the table(class= @@model IEnumerable<BookGroup>)-->
                <th>@Html.DisplayNameFor(model => model.Name)</th>
                <th>@Html.DisplayNameFor(model => model.Description)</th>

                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            @{
                int counter = 1;
            }
            @foreach (var item in Model)
            {
                <tr>
                    <td>@(counter++)</td>

                    <td>@item.Name</td>

                    <td>@item.Description</td>



                    <td class="align-middle">
                        <div class="dropdown dropright ">
                            <a class="fa fa-spin " aria-haspopup="true" aria-expanded="false" data-toggle="dropdown">
                                <i class="fa fa-cog  fa-spin"></i>
                            </a>
                            <div class="dropdown-menu justify-content-center">
                                <a class="text-info  dropdown-item" data-toggle="modal" id="show-edit-book" asp-action="EditBook"
                                   data-target="#modal-action-country" asp-route-id="@item.Id">
                                    <i class="p-1 fa fa-pencil"></i>
                                    <span>ویرایش</span>
                                </a>

                                <div class="dropdown-divider"></div>

                                <a class="text-danger dropdown-item" data-toggle="modal" id="show-delete-book" asp-action="DeleteBook"
                                   data-target="#modal-action-country" asp-route-id="@item.Id">
                                    <i class="p-1 fa fa-trash"></i>
                                    <span>حذف</span>
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
            }

        </tbody>
    </table>

</div>
<partial name="~/Views/Shared/Partials/Modal/_ModalPartial.cshtml" model='new BootstrapModel { Id ="modal-action-country", Size=ModalSize.Large }' />
@*@await Html.PartialAsync("~/Views/Shared/Partials/Modal/_ModalPartial.cshtml", new BootstrapModel { Id = "modal-action-country", Size = ModalSize.Large })*@

@section panelScript{
    <script src="~/node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script>
        //آپلود فایل
        var UploadImage = function (inputId) {

            //-------------------- ذخیره تصاویر رویمتغیر برای ارسال به اکشن-------------------
            var data = new FormData;
            var file;

            //همه فایل های داخل اینپوت فایل را  دریافت میکند
           file = $(inputId).prop("files");

            //اضافه کردن فایل ها به متغیر برای ارسال به اکشن
            for (var i = 0; i < file.length; i++) {
                 // data مهم است نه نام  files در دریافت اطلاهات فرم و تصویر اپلود نام
                // میسازیم data نامی که در متغیر files
                //data={files:"asdfdasf.jpg"}
                data.append('files', file[i]);
            }

            data.append("inputId",inputId)
            //---------------------------------------
            $.ajax({
                type: "post",
                url: '@Url.Action("UploadFile","Country", new { area = "AdminPanel"})',

                data: data,
                contentType: false,
            //    dataType: "json",
                processData: false,

                success: function (result) {
                    if (result.status == "success") {

                        if (inputId === "#indexFiles") {

                            //-------------برای نمایش تصویر شاخص کشور-------------------------
                            //دریافت نام تصویر آپلود شده
                            $("#IndexImages").attr('src', "\\upload\\country\\indexImage\\thumbnailImage\\" + result.indexImagName);
                            $("#divmessage").removeClass('d-none');
                            $("#divmessage").text("تصویر با موفقیت آپلود شد");

                            //ذخیره نام تصویر شاخص مجموعه تصاویر و ویدوهای کشور
                            //در تگ اینپوت مربوطه برای دسترسی به انها بعد از پلود و ثبت در دیتابیس
                            if (result.indexImagName != null) {

                                //ذخیره نام تصویرشاخص در تگ
                                $("#IndexImage").attr("value",result.indexImagName);
                            }

                        }
                        else if (inputId === "#imagesFiles") {
                            if (result.imageNames != null) {

                                //ذخیره نام تصاویر در تگ
                                for (var i = 0; i < result.imageNames.length; i++) {
                                    $("div#hidden-input>div#images-hidden").append('<input type="text" class="d-none images" name="images"  />');
                                    $('input.images').eq(i).attr("value", result.imageNames[i]);
                                }
                            }
                        }
                        else if (inputId === "#videosFiles") {

                            if (result.videoNames != null) {

                                //ذخیره نام ویدوها در تگ
                                for (var i = 0; i < result.imageNames.length; i++) {
                                    $("div#hidden-input>div#videos-hidden").append('<input type="text" class="d-none videos" name="videos"  />');
                                    $('input.videos').eq(i).attr("value", result.videoNames[i]);
                                }
                            }
                        }
                       //----------------------------------------------------------------------------------

            //-----------مخفی کردن دمه انتخاب و اپلود مجموعه تصاویر وفیلمها بعد از موفقیت امیز بودن  اپلود------------
            if (inputId==="#imgFiles") {

                $('#btnupload-images').addClass("d-none");
                $(inputId).parentsUntil("div.btn-group").addClass("d-none");
                $('#img-success').removeClass("d-none").addClass("d-block");
                $('#img-success>span').html(result.message);

            } else if(inputId==="#videoFiles"){
                $('#btnupload-videos').addClass("d-none");
                $(inputId).parentsUntil("div.btn-group").addClass("d-none");
                $('#video-success').removeClass("d-none").addClass("d-block");
                $('#video-success>span').html(result.message);

                    };
                  //---------------------------------------------------------------
                };
                    if (result.status === "typeError") {
                        Swal.fire({
                            type: "warning",
                            html: "<span class='text-dark font-weight-bold'>" + result.message + "</span>",
                            animation: false,
                            confirmButtonColor: '#ff9800',
                             confirmButtonText: 'تایید',
                            customClass: {
                                popup: 'animated tada'
                            }
                        });
                    };
                    if (result.status === "empty") {
                        Swal.fire({
                            type: "warning",
                            html: "<span class='text-dark font-weight-bold'>" + result.message + "</span>",
                            animation: false,
                            confirmButtonColor: '#ff9800',
                             confirmButtonText: 'تایید',
                            customClass: {
                                popup: 'animated tada'
                            }
                        });
                    }
                }
            }).done(function (result) {
                //todo:loding button ایچجاد کنم

                //if (result.status === "typeError") {
                //    Swal.fire({
                //        title: "done",
                //        animation: false,
                //        customClass: {
                //            popup: 'animated tada'
                //        }
                //    });
                //};
            }).fail(function (result) {

                if (result.status != "success") {
                        Swal.fire({
                            type: "warning",
                            html: "<span class='text-dark font-weight-bold'>" +" در هنگام آپلود مشکلی رخ داد" + "</span>",
                            animation: false,
                            confirmButtonColor: '#ff9800',
                             confirmButtonText: 'تایید',
                            customClass: {
                                popup: 'animated tada'
                            }
                        });

                    $("#divmessage").removeClass('hidden');
                    $("#divmessage").text("در هنگام آپلود مشکلی رخ داد");

                }
            });
        };
    </script>
    
}

















@*<script>
            $(document).ready(function () {
                /*اسکریپت مودال یا تب های مرحله ای*/
                var currentTab = 0; // Current tab is set to be the first tab (0)
                $("#add-country").click(function () {

                showTab(currentTab); // Display the current tab



                $("#nextBtn,#prevBtn").click(function () {
                    var e=$(this).attr("data-click-id");
                    nextPrev(e); // Display the current tab
                });
                function showTab(n) {
                    // This function will display the specified tab of the form ...
                    var x = $(".modal-bocy>div.tab");
                    x.eq(n).removeClass("d-none").addClass("d-block");
                    // ... and fix the Previous/Next buttons:
                    if (n == 0) {
                        $("#prevBtn").removeClass("d-inline-block").addClass("d-none");
                    }
                    else {
                        $("#prevBtn").removeClass("d-none").addClass("d-inline-block");
                    }
                    if (n == (x.length - 1)) {
                        $("#nextBtn").html("اقزودن کشور");
                    } else {
                        $("#nextBtn").html("بعدی");
                    }
                    // ... and run a function that displays the correct step indicator:
                    fixStepIndicator(n)
                };

                function nextPrev(n) {
                    // This function will figure out which tab to display
                    var x = $(".tab");

                    //برای  اینگه اگر ولیدیشن چکبود مرحله بعد نرود
                    // Exit the function if any field in the current tab is invalid:
                  //  if (n == 1 && !validateForm()) return false;

                    // Hide the current tab:
                    x.eq(currentTab).removeClass("d-block").addClass("d-none");
                    // Increase or decrease the current tab by 1:
                    currentTab = currentTab + n;
                    // if you have reached the end of the form... :
                    if (currentTab >= x.length) {
                        //...the form gets submitted:
                       $("#regForm").submit();
                        return false;
                    }
                    // Otherwise, display the correct tab:
                    showTab(currentTab);
                };
                //متد چک کردن ورودی ها
                //function validateForm() {
                //    // This function deals with validation of the form fields
                //    var x, y, i, valid = true;
                //    x = document.getElementsByClassName("tab");
                //    y = x[currentTab].getElementsByTagName("input");
                //    // A loop that checks every input field in the current tab:
                //    for (i = 0; i < y.length; i++) {
                //        // If a field is empty...
                //        if (y[i].value == "") {
                //            // add an "invalid" class to the field:
                //            y[i].className += " invalid";
                //            // and set the current valid status to false:
                //            valid = false;
                //        }
                //    }
                //    // If the valid status is true, mark the step as finished and valid:
                //    if (valid) {
                //        document.getElementsByClassName("step")[currentTab].className += " finish";
                //    }
                //    return valid; // return the valid status
                //}



                function fixStepIndicator(n) {
                    // This function removes the "active" class of all steps...
                    var i, x = $(".step");
                    x.each(function () {
                       x.removeClass("active");
                    });
                    //for (i = 0; i < x.length; i++) {
                    //    x[i].className = x[i].className.replace(" active", "");
                    //}
                    //... and adds the "active" class to the current step:
                    x.eq(n).addClass(" active");
                    };

                });
    });
        </script>*@




